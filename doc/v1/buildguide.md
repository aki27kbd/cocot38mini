# Build Guide

![cocot38mini_main02](/images/main_02.jpg)

cocot38miniのビルドガイドになります。  

cocot38miniは、cocotシリーズをベースによりコンパクトさを追求したモデルです。25mmトラックボール専用に設計されたカラムスタッガード30%キーボードで、専用の3Dプリントケースが用意されています。まず始めにこのビルドガイドを最後までよく読み、必要なものを揃えた上で組み立てに取り掛かってください。


## 部品
### キット付属品

|名前|数|備考|
|---|---|---|
|メインPCB|1枚||
|センサーPCB|1枚||
|マウスセンサー（PMW3360）|1個||
|PGA2040|1個||
|ゴム脚|4個||
|ジルコニア球（2mm）|3個||


### キット以外に必要なもの

|名前|数|備考|
|---|---|---|
|3Dプリントケース（トップ・ボトム）|各1個|公開されている3Dデータを元に3Dプリントサービスに発注|
|キースイッチ|37 or 38個|MX互換|
|キーキャップ|37 or 38個|MX互換|
|ロータリーエンコーダ+ノブ（直径19mm以下）|1個|オプション|
|コンスルー or ピンヘッダ（高さ2.5mm）|ピン合計が42本以上必要||
|トラックボール（25mmボール）|1個||
|USB-TypeCケーブル|1本||


## 組み立て
### 部品確認

  まずはキット付属品に記載されたパーツが揃っているか確認ください。  
  その他上述の「キット以外に必要なもの」を揃えた上で組み立てに取り掛かってください。

  - タブ付きPCBの場合にはタブを割って切り離し、切断面を軽くヤスリがけしてください。


### PGA2040

  PGA2040にコンスルー（or ピンヘッダ）をはんだ付けします。ここではコンスルーを例として扱いますが、ピンヘッダを用いる場合も基本的には同様です。

  コンスルー（高さ2.5mm）をカッターナイフなどで切り分け、下の写真のようにPCB裏面に差し込みます。本数や向きの組み合わせは多少写真と異なっていても問題ありません。（写真では8ピン×2本、6ピン×3本としています。）コンスルーを差し込むピンの位置を間違えないように注意してください。  
  ![cocot38mini_bg_](/images/bg_pga2040_1.jpg)

  ![cocot38mini_bg_](/images/bg_pga2040_2.jpg)

  コンスルーを差し込んだら、PGA2040を上から差し込みます。***PGA2040の向き（表裏・上下）に細心の注意を払ってください。***  
  ![cocot38mini_bg_](/images/bg_pga2040_3.jpg)

  コンスルー、PGA2040が浮いていないか確認し、PGA2040側の34ピン分はんだ付けを行ってください。
  ![cocot38mini_bg_](/images/bg_pga2040_4.jpg)


### ファームウェア

  コンスルーのはんだ付けが終わったら、PGA2040をPCBに差し込み、ファームウェアの書き込みを行います。

  - 裏面のBOOTボタン（SW40）を押しながらRESETボタン（SW39）を押し、ブートローダーモードに入ります。
  - その状態でRPI-RP2というドライブに[.uf2](https://github.com/aki27kbd/cocot38mini/blob/main/firmware/aki27_cocot38mini_vial.uf2)ファイルをドラッグ&ドロップすることでファームが書き込まれます。　　
  ![cocot38mini_bg_](/images/bg_firmware.jpg)  

  キーマップは[vial](https://vial.rocks/)から更新可能です。  
  トラックボール、LED含めて上記.uf2ファイルで確認いただけます。
  トラックボールの動作は後述のセンサー基板を組み立ててから行ってください。  
  ![vial](/images/vial.jpg)

  デフォルトのファームウェアでは自動マウスレイヤー機能がオンになっています。この機能では、トラックボールを動かすと自動的にマウスレイヤー（レイヤー4）に移動することが可能です。カスタムキーコード（`AM_TOG`）を押すことで自動マウスレイヤー機能のオンオフを切り替えられます。

  ソースコードは[こちら](https://github.com/aki27kbd/vial-qmk/tree/vial/keyboards/aki27/cocot38mini)を参照ください。      


### センサー基板

  センサー基板にマウスセンサー（PMW3360）を基板裏面から写真の向きに設置し、表面からはんだ付けを行います。シルクの●印と基板の●印の位置が合うように注意してください。    
  ![cocot38mini_bg_](/images/bg_pmw3360_1.jpg)

  センサーの脚がしっかり奥まで入った状態で、浮かないようにマスキング テープなどで固定します。  
  表面から16本の脚をはんだ付けします。センサーに貼られているテープを剥がし、表面からレンズを付けます。    
  ![cocot38mini_bg_](/images/bg_pmw3360_2.jpg)

  次にセンサー基板にコンスルー（or ピンヘッダ）をはんだ付けします。ここではコンスルーを例として扱いますが、ピンヘッダを用いる場合も基本的には同様です。

  コンスルー（高さ2.5mm）をカッターナイフなどで切り分け、下の写真のようにPCB裏面に差し込みます。本数や向きの組み合わせは多少写真と異なっていても問題ありません。コンスルーを差し込むピンの位置を間違えないように注意してください。  
  ![cocot38mini_bg_](/images/bg_pmw3360_3.jpg)

  コンスルーを差し込んだら、センサー基板を上から差し込みます。***センサー基板の向き（表裏・上下）に細心の注意を払ってください。***  
  ![cocot38mini_bg_](/images/bg_pmw3360_4.jpg)

  コンスルー、センサー基板が浮いていないか確認し、センサー基板側の8ピン分はんだ付けを行ってください。
  ![cocot38mini_bg_](/images/bg_pmw3360_5.jpg)

  はんだ付け後、センサー基板をPCBに差し込み、センサー近くで指をかざしてカーソルが動くか確認してください。


### ロータリーエンコーダ（オプション）

  オプションのロータリーエンコーダを付ける場合は写真の位置に差し込み、裏側から5か所はんだ付けを行ってください。ロータリーエンコーダを搭載せずキースイッチを付ける場合はこの工程をスキップしてください。  
  ![cocot38mini_bg_](/images/bg_rotary_encoder.jpg)


### トラックボール支持球

  3Dプリントトップケースにジルコニア球を接着します。2液混合エポキシ接着剤などをお使いください。  
  ![cocot38mini_bg_](/images/bg_zirconia_1.jpg)

  爪楊枝などの先に接着剤を適量取り、トップケースにある3か所の窪みに塗ります。  
  ![cocot38mini_bg_](/images/bg_zirconia_2.jpg)

  ジルコニア球を接着剤の付いた窪みにはめ込み、固まるまで放置します。  
  接着剤が周囲にあふれた場合は固まる前にふき取ってください。  
  ジルコニア球接着後は下記の写真のようになります。  
  ![cocot38mini_bg_](/images/bg_zirconia_3.jpg)


### 組み立て

  はんだ付けと動作確認が終わった基板をトップケースと重ね、四隅から順番にキースイッチをはめていきます。キースイッチの脚が曲がってしまわないように注意してください。また、基板がトップケースと密着するようにキースイッチをはめてください。  
  ![cocot38mini_bg_](/images/bg_assembly_1.jpg)

  キースイッチがはめ終わった状態です。  
  ![cocot38mini_bg_](/images/bg_assembly_2.jpg)

  トップケースとボトムケースをはめていきます。まずボトムケースの奥側の溝（写真①②）がトップケースとかみ合うように合わせてください。  
  ![cocot38mini_bg_](/images/bg_assembly_3.jpg)

  ①②がはまった状態で、残りの溝をトップケースにはめていきます。③→④→⑤の順番にカチッとはまるまで押し込んでください。ボトムケースを①②側に寄せながら押し込むとはまりやすくなります。  
  ![cocot38mini_bg_](/images/bg_assembly_4.jpg)

  ボトムケースがはまったら、ゴム脚を貼り付けます。
  ![cocot38mini_bg_](/images/bg_assembly_5.jpg)

  ボール、キーキャップをはめて完成です。
  ![cocot38mini_bg_](/images/bg_assembly_6.jpg)


## カスタムキーコード

  トラックボールの操作に関していくつかカスタムキーコードを設定することが可能です。（SCRL_MOはレイヤー4でのみ有効）

  Keycode   |Description
  ---------|-----------
  `CPI_SW`  |トラックボールのCPIを変更します。デフォルトのファームウェアでは、押すたびに200→400→800→1600→3200→200…という順番でCPIが変わります。
  `SCRL_SW` |スクロールモードにおけるセンサーの感度を変更します。数値が大きいほどスクロール量が小さくなります。
  `ROT_R15` |マウスセンサーのＹ軸を時計回りに15度回転させます。
  `ROT_L15` |マウスセンサーのＹ軸を反時計回りに15度回転させます。
  `SCRL_MO` |押されている間スクロールモードになります。（デフォルトファームではレイヤー4でのみ有効）
  `SCRL_TO` |押すたびにスクロールモードとマウスモードを切り替えます。（デフォルトファームでは無効）
  `SCRL_IN` |スクロール方向を反転させます。
  `AM_TOG` |自動マウスレイヤー切り替えのオンオフを切り替えます。

  vialでカスタムキーコードを設定する場合はUserタブ下のカスタムキーコードを用いて設定することが可能です。  
  ![CustomKeycode_rev](/images/bg_customkeycode.jpg)


## 終わりに
何かトラブルがあれば[Twitterアカウント](https://twitter.com/aki27kbd)までご連絡ください。

また、完成写真をSNSにアップいただけるととても励みになります。（アップするのがはばかられる方はDMで直接送りつけていただいても構いません。）

ハッシュタグは #cocot38mini です。
